<!DOCTYPE html>
<html>
<head>
	<title></title>
</head>
<body>
	<canvas id="cvs" resize></canvas>
	<!--script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script-->
	<script src="../lib/jquery-1.9.0.min.js">:</script>
	<script src="../lib/processing-1.4.1.min.js"></script>
	<script src="main.js"></script>
	<script>
$(function(){
	if (typeof Object.create !== 'function') {
    	Object.create = function (o) {
	        function F() {}
	        F.prototype = o;
	        return new F();
    	};
	}

	var pjs = new Processing($('#cvs')[0]);

	var bubble = {
		init : function(x, y, incidence){
			//if(this.running) return;

			this.running = true;
			this.point = new pjs.PVector(x,y);
			this.initiaRadius = Math.random() * 100;
			this.radius = this.initiaRadius;
			this.color = [(Math.random() * 256),(Math.random() * 256),(Math.random() * 256)];
			this.updatedCount = 0;

			this.nextIncidence = Math.round(Math.random() * incidence);
			this.eruptionTime = Math.round(Math.random() * 30);
			this.children = new Array();
			for(var i = 0; i < this.nextIncidence; i++){
				this.children[i] = Object.create(bubble);
				var childX = pjs.width * Math.random();
				var childY = pjs.height * Math.random();
				this.children[i].init(childX, childY, this.nextIncidence);
				this.children[i].running = false;
			}
			//console.log('nextIncidence='+this.nextIncidence+',eruptionTime='+this.eruptionTime+',children.leng='+this.children.length);
		}
		, update : function(){
			if(!this.running) return;

			++this.updatedCount;
			this.radius = this.initiaRadius - (Math.pow(this.updatedCount, 2) / this.initiaRadius);

			if(this.updatedCount > this.eruptionTime) for(var i = 0; i < this.children.length; i++) this.children[i].running = true;

			for(var i = 0; i < this.children.length; i++) this.children[i].update();

			if(this.radius < 1){
				for(var i = 0; i < this.children.length; i++){
					if(this.children[i].running) return;
				}
				this.running = false;
			}
		}
		, display : function(){
			if(!this.running) return;

			pjs.stroke(255);
			pjs.fill(this.color[0],this.color[1],this.color[2]);
			pjs.ellipse(this.point.x, this.point.y, this.radius, this.radius);
			for(var i = 0; i < this.children.length; i++) this.children[i].display();
		}
	};

	var init = function(){
		pjs.setup = function(){
			pjs.size(window.innerWidth, window.innerHeight);
			pjs.frameRate(10);
		};
		pjs.draw = function(){
			pjs.background(173,216,230);
			bubble.display();
			bubble.update();
		};
		pjs.mousePressed = function(){
			if(!bubble.running) bubble.init(pjs.mouseX, pjs.mouseY, 10);
		};
		pjs.mouseReleased = function(){
		};
		pjs.setup();
	};
	init();
});
	</script>
</body>
</html>