<!DOCTYPE html>
<html>
<head>
	<title></title>
</head>
<body>
	<canvas id="cvs" resize></canvas>
	<!--script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script-->
	<script src="../lib/jquery-1.9.0.min.js">:</script>
	<script src="../lib/processing-1.4.1.min.js"></script>
	<script src="main.js"></script>
	<script>
$(function(){
	if (typeof Object.create !== 'function') {
    	Object.create = function (o) {
	        function F() {}
	        F.prototype = o;
	        return new F();
    	};
	}

	var pjs = new Processing($('#cvs')[0]);

	var bubble = {

		init : function(incidence){
			// basic setting
			this.point = new pjs.PVector(pjs.width * Math.random(), pjs.height * Math.random());
			this.initialRadius = Math.random() * 128;
			this.radius = this.initialRadius;
			this.color = [(Math.random() * 256),(Math.random() * 256),(Math.random() * 256)];
			this.strokeWeight = this.initialRadius / 64;
			this.velocity = new pjs.PVector((Math.random() - 0.5) * 2, (Math.random() - 0.5) * 2);
			this.alpha = 0;

			// about children
			this.incidence = incidence || 8;
			this.eruptionTime = Math.round(Math.random() * 56);
			this.children = [];

			// update control
			this.updatedCount = 0;
			this.running = true;
		}

		, update : function(){
			if(!this.running) return;

			// update shape, color, etc.
			this.radius = this.initialRadius - (Math.pow(this.updatedCount, 2) / this.initialRadius);
			this.alpha = Math.pow(this.updatedCount, 3);
			if(this.alpha > 255) this.alpha = 255;

			// breeding time?
			if(this.updatedCount == this.eruptionTime){
				var nextIncidence = Math.floor(Math.random() * this.incidence);
				for(var i = 0; i < nextIncidence; i++){
					this.children[i] = Object.create(this);
					this.children[i].init(nextIncidence);
				}
			}

			// update children
			for(var i = 0; i < this.children.length; i++) this.children[i].update();

			// end of life
			if(this.radius < 1){
				var stillRunning = false;
				for(var i = 0; i < this.children.length; i++){
					if(this.children[i].running) stillRunning = true;
				}
				if(!stillRunning){
					this.children = [];
					this.running = false;
				}
			}

			++this.updatedCount;
		}

		, display : function(){
			if(!this.running) return;

			this.point.add(this.velocity);

			pjs.strokeWeight(this.strokeWeight);
			pjs.stroke(255);
			pjs.fill(this.color[0],this.color[1],this.color[2],this.alpha);
			pjs.ellipse(this.point.x, this.point.y, this.radius, this.radius);
			for(var i = 0; i < this.children.length; i++) this.children[i].display();
		}
	};

	var bubbles = [];
	var initialIncidence = 8;

	var init = function(){
		pjs.setup = function(){
			pjs.size(window.innerWidth, window.innerHeight);
			pjs.frameRate(16);
		};
		pjs.draw = function(){
			pjs.background(173,216,230);

			var stillRunning = false;
			for(var i = 0; i < bubbles.length; i++){
				bubbles[i].update();
				bubbles[i].display();
				if(bubbles[i].running) stillRunning = true;
			}
			if(!stillRunning) bubbles = [];
		};
		pjs.mousePressed = function(){
			if(bubbles.length == 0) {
				for(var i = 0; i < initialIncidence; i++){
					bubbles[i] = Object.create(bubble);
					bubbles[i].init(initialIncidence);
				}
			}
		};
		pjs.mouseReleased = function(){
		};
		pjs.setup();
	};
	init();
});
	</script>
</body>
</html>