<!DOCTYPE html>
<html>
<head>
	<title></title>
</head>
<body>
	<canvas id="cvs" resize></canvas>
	<!--script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script-->
	<script src="../lib/jquery-1.9.0.min.js">:</script>
	<script src="../lib/processing-1.4.1.min.js"></script>
	<script src="main.js"></script>
	<script>
$(function(){
	if (typeof Object.create !== 'function') {
    	Object.create = function (o) {
	        function F() {}
	        F.prototype = o;
	        return new F();
    	};
	}

	var pjs = new Processing($('#cvs')[0]);

	var bubble = function(incidence){

		var point = new pjs.PVector(pjs.width * Math.random(), pjs.height * Math.random());
		var initialRadius = Math.random() * 128;
		var radius = initialRadius;
		var color = [(Math.random() * 256),(Math.random() * 256),(Math.random() * 256)];
		var strokeWeight = initialRadius / 64;
		var velocity = new pjs.PVector((Math.random() - 0.5) * 2, (Math.random() - 0.5) * 2);
		var alpha = 0;

		// about children
		incidence = incidence || 8;
		var eruptionTime = Math.round(Math.random() * 56);
		var children = [];

		// update control
		var updatedCount = 0;

		return {
			running : true
			, update : function(){
				if(!this.running) return;

				// update shape, color, etc.
				radius = initialRadius - (Math.pow(updatedCount, 2) / initialRadius);
				alpha = Math.pow(updatedCount, 3);
				if(alpha > 255) alpha = 255;

				// breeding time?
				if(updatedCount == eruptionTime){
					var nextIncidence = Math.floor(Math.random() * incidence);
					for(var i = 0; i < nextIncidence; i++) children[i] = Object.create(bubble(nextIncidence));
				}

				// update children
				for(var i = 0; i < children.length; i++) children[i].update();

				// end of life
				if(radius < 1){
					var stillRunning = false;
					for(var i = 0; i < children.length; i++){
						if(children[i].running) stillRunning = true;
					}
					if(!stillRunning){
						children = [];
						this.running = false;
					}
				}

				++updatedCount;
			}

			, display : function(){
				if(!this.running) return;

				point.add(velocity);

				pjs.strokeWeight(strokeWeight);
				pjs.stroke(255);
				pjs.fill(color[0],color[1],color[2],alpha);
				pjs.ellipse(point.x, point.y, radius, radius);
				for(var i = 0; i < children.length; i++) children[i].display();
			}
		}
	};

	var bubbles = [];
	var initialIncidence = 8;

	var init = function(){
		pjs.setup = function(){
			pjs.size(window.innerWidth, window.innerHeight);
			pjs.frameRate(16);
		};
		pjs.draw = function(){
			pjs.background(173,216,230);

			var stillRunning = false;
			for(var i = 0; i < bubbles.length; i++){
				bubbles[i].update();
				bubbles[i].display();
				if(bubbles[i].running) stillRunning = true;
			}
			if(!stillRunning) bubbles = [];
		};
		pjs.mousePressed = function(){
			if(bubbles.length == 0) {
				for(var i = 0; i < initialIncidence; i++) bubbles[i] = Object.create(bubble(initialIncidence));
			}
		};
		pjs.mouseReleased = function(){
		};
		pjs.setup();
	};
	init();
});
	</script>
</body>
</html>